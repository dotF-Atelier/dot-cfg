Physically Based Shading at Disney
by Brent Burley, Walt Disney Animation Studios

1 Introduction
Following our success with physically based hair shading on Tangled [27], we began considering physically based shading models for a broader range of materials. With the physically based hair model, we were able to achieve a great degree of visual richness while maintaining artistic control. However, it proved challenging to integrate the lighting of the hair with the rest of the scene which had still used traditional “ad-hoc” shading models and punctual lights. For subsequent ﬁlms we wanted to increase the richness of all of our materials while making lighting responses more consistent between materials and environments and also wanted to improve artist productivity through the use of simpliﬁed controls.
When we began our investigation it wasn’t obvious which models to use or even how physically based we wanted to be. Should we be perfectly energy conserving? Should we favor physical parameters like index of refraction?
For diﬀuse, Lambert seemed to be the accepted norm, while specular seemed to get most of the attention in the literature. Some models such as Ashikhmin-Shirley (2000) [3] aimed to be intuitive and practical while physically plausible, while others such as He et al. (1991) [12] provided a more comprehensive physical model. Still others aimed at improved data ﬁtting [15, 14, 22, 17, 4], but few of these are appropriate for direct manipulation. We could have implemented several models and let the artists choose and combine them, but then we’d have been back to the parameter explosion we were trying to get away from.
One study of a large variety of measured materials was Ngan et al. (2005) [21] which compared ﬁve popular models. Some models fared better than others overall, but interestingly, there was a strong correlation between the models’ performances — some materials were well represented by all the models, and for others, no model proved suitable. Adding an additional specular lobe helped in only a few of the cases. This begs the question: what is not being represented in the diﬃcult materials?
To answer this question and to evaluate BRDF models more intuitively we developed a new BRDF viewer that could display and compare both measured and analytic BRDFs. We discovered new, intuitive ways to view measured BRDF data and we found interesting features in the measured materials that weren’t well represented by known models.
In these course notes we will share observations from studying measured materials along with insights we’ve gleaned about which models ﬁt the measured data and where they fall short. We will then present our new model which is now being used on all current productions. We will also describe our experience of adopting this new model in production and discuss how we were able to add the right level of artistic control while preserving simplicity and robustness.

2 The microfacet model

We will deﬁne our BRDF and compare with measured materials in terms of the microfacet model [30,

7, 33]. The microfacet model postulates that if a surface reﬂection can occur between a given light

vector l and view vector v, then there must exist some portion of the surface, or microfacet, with a

normal aligned halfway between the l and v vectors. This “half vector”, sometimes referred to as the

microsurface

normal,

is

thus

deﬁned

as

h

=

l+v |l+v|

.

A

general

form

of

the

microfacet

model

for

isotropic

1

materials is:

f (l, v) = diﬀuse + D(θh)F (θd)G(θl, θv) 4 cos θl cos θv

The diﬀuse term is a function of unknown form. Lambert diﬀuse is often assumed and is represented

by a constant value. For the specular term, D is the microfacet distribution function and is responsible

for the shape of the specular peak, F is the Fresnel reﬂection coeﬃcient, and G is the geometric

attenuation or shadowing factor.

θl and θv are the angles of incidence of the l and v vectors with respect to the normal, θh is the angle between the normal and the half vector, and θd is the “diﬀerence” angle between l and the half vector (or, symmetrically, v and h).

Most physically plausible models not speciﬁcally described in microfacet form can still be inter-

preted as microfacet models in that they have a distribution function, a Fresnel factor, and some

additional factor which could be considered a geometric shadowing factor. The only real diﬀerence

between

microfacet

models

and

other

models

is

whether

they

include

the

explicit

1 4 cos θl cos θv

factor

that

comes from the microfacet derivation. For models that don’t include this factor, an implied shadowing

factor can be determined by multiplying the model by 4 cos θl cos θv after factoring out the D and F factors.

3 Visualizing measured BRDFs
3.1 The “MERL 100”

Figure 1: Images slices of MERL 100 BRDFs. 2

A set of 100 isotropic BRDF material samples was captured by Matusik et al. in 2003 [18] covering a wide range of materials including paints, woods, metals, fabric, stone, rubber, plastic, and other synthetic materials. This data set is freely available from Mitsubishi Electric Research Laboratories at www.merl.com/brdf and is commonly used for evaluating new BRDF models. Slices of these BRDFs are shown in Figure 1.
Each BRDF in the MERL 100 is densely sampled into a 90 by 90 by 180 cube along the θh, θd, and φd axes respectively. These correspond to 1 degree increments except for the θh axis which was warped to concentrate data samples near the specular peak. The measurements have been ﬁltered and extrapolated as needed so that there are no holes in the data. This is good in that the data is easy to use, but it’s not clear how accurate the data is, particularly near the horizon. Because of this, some researchers discard data near the horizon when performing ﬁtting, but this data is still useful to consider as it can have a profound eﬀect on the material appearance.
3.2 BRDF Explorer
Figure 2: Disney BRDF Explorer To examine the MERL measured materials and compare with analytic models, we developed a new tool, the BRDF Explorer, shown in Figure 2. It is available as open source at github.com/wdas/brdf and has the following features: • Ability to load multiple analytic BRDFs written in GLSL
3

• Ability to load measured BRDFs, including the anisotropic material samples captured by Ngan et al. [21]
• Multiple data plots (3D hemispherical view, polar plot, and various cartesian plots) • Computed albedo plot (i.e., directional-hemispherical reﬂectance) • Image slice view with exposure controls • Lit object view with importance-sampled IBL • Lit sphere view • Dynamic UI controls for parametric models This tool has been invaluable in comparing measured materials with existing analytic models as well as in developing our new model. Surprisingly, it has also proven very useful for artists as an interactive BRDF editor, giving them a deeper understanding of the model parameters and BRDF space.
3.3 Image slice

h

l

v

θd l hv

l

v

h

θl,θv θh

v lh

l=h=v

l=h=v

l=h=v

specular peak

Fresnel peak diffuse

red-plastic

grazing retro-reflection

red-specular-plastic

Figure 3: BRDF images slices for red-plastic and specular-red-plastic shown along with schematic view of “slice space.”
One of the simplest, most intuitive ways to visualize a measured material is to simply view it as a stack of images, and we’ve found this to be a very powerful tool to gain an intuition about the data. As it turns out, all of the interesting features in the MERL 100 materials are visible in the φd = 90 slice. A schematic view of this space along with two material samples is shown in Figure 3. Other slices are roughly just warped versions of that slice as shown in Figure 4. This observation has been exploited in recent work such as Romeiro (2008) [26] and Pacanowsi (2012) [24] as the basis for simpliﬁed isotropic BRDF models of the form f (θh, θd).
In the image slice, the left edge represents the specular peak, and the top edge represents the Fresnel peak. Note that along the bottom edge, the light and view vectors are coincident, thus the bottom
4

0

30

60

90

Figure 4: Slices of specular-red-plastic for diﬀerent values of φd, the azimuthal rotation of l around the half vector. The black region in the upper right corner represents a portion of the BRDF domain
where either the l or v vector is below the horizon.

edge represents retroreﬂection. The lower-right corner in particular represents grazing retroreﬂection. Diﬀuse reﬂectance is exhibited over the entire BRDF space, but the middle of the image is generally isolated to the diﬀuse response.
The schematic image in Figure 3 also includes an isoline of θl or θv. Many diﬀuse eﬀects tend to follow this contour. Note that these isolines straighten as φd approaches zero, and comparing φd slices can give insight about which parts of the material response are due to diﬀuse reﬂection and which are specular. Another hint is of course color; diﬀuse reﬂectance is due to subsurface scattering and absorption which results in a visible tint, whereas specular reﬂectance comes from the surface and is not tinted (unless the surface is metallic, in which case there is no diﬀuse component).

4 Observations from MERL materials
4.1 Diﬀuse observations

alumina-oxide light-red-paint orange-paint

gold-paint

green-latex

yellow-matteplastic

Figure 5: Materials exhibiting diﬀuse color variation. Top row: point-light responses on rendered spheres; bottom row: BRDF image slices.
Diﬀuse reﬂectance represents light that is refracted into the surface, scattered, partially absorbed, and re-emitted. Given that some of the light is absorbed, the diﬀuse response will be tinted with the surface color, and any portion of a non-metallic material that is tinted can be considered to be diﬀuse.

5

0.5

0.5

0.4

0.4

0.3

0.3

0.2

0.2

0.1

0.1

0.0 0

30

60

90 0.00

30

60

90

θh

θh

Figure 6: Retroreﬂective responses of MERL 100 materials. Left: 50 smooth materials (f (0) > 0.5);
right: 50 rough materials (f (0) < 0.5). The peak near θh = 0 is the specular peak, and the peak (or drop) near θh = 90 represents grazing retroreﬂection.

Figure 7: Point light response of red-plastic, specular-red-plastic, and Lambert diﬀuse.
The Lambert diﬀuse model assumes that the refracted light has scattered enough that it has lost all directionality and thus the diﬀuse reﬂectance is constant. However, it can be seen in the various image slices in Figures 1 and 5 that very few materials exhibit a Lambertian response. [Note: a Lambert shader includes an n · l factor, but that’s part of the lighting integral, not the BRDF.]
As shown in Figure 6, many materials show a drop in grazing retroreﬂection, and many others show a peak. This appears to be a diﬀuse phenomenon due to the apparent tinting in the image slices. Notably, this is strongly correlated to roughness — smooth surfaces, i.e., those with a higher specular peak, tend to have a shadowed edge, and rough surfaces tend to have a peak instead of a shadow. This correlation can be seen in the retroreﬂective response curves and also in the rendered spheres in Figure 7.
The grazing shadow for smooth surfaces is predicted by the Fresnel equations: at grazing angles, more energy is reﬂected from the surface and less is refracted into the surface to be diﬀusely re-emitted. However, diﬀuse models don’t generally consider the eﬀect of surface roughness on Fresnel refraction and either assume a smooth surface or ignore the Fresnel eﬀect.
The Oren-Nayar model (1995) predicts a retroreﬂective increase for rough diﬀuse surfaces that
6

Lambert
Oren-Nayar
Hanrahan-Krueger
Figure 8: BRDF slices and point-light responses of Lambert, Oren-Nayar, and Hanrahan-Krueger diﬀuse models.
ﬂattens the diﬀuse shape. However, this retroreﬂective peak isn’t as strong as the measured data and the rough measured materials don’t generally exhibit ﬂattening of the diﬀuse. The Hanrahan-Krueger model (1993), derived from subsurface scattering theory, also predicts a ﬂattening of the diﬀuse shape, but doesn’t have a strong enough peak at the edge. In contrast to Oren-Nayar, this model assumes a perfectly smooth surface. The Oren-Nayar and Hanrahan-Krueger models are compared in Figure 8.
Besides the retroreﬂective peak, additional diﬀuse variation can be seen in the image slices in Figure 5. Both intensity and color variation can be seen that follows the θl / θv isolines. This may be due in some cases to layered subsurface scattering. However, even layered subsurface scattering models generally consider the surface to be smooth and don’t produce a strong retroreﬂective peak.
4.2 Specular D observations
The microfacet distribution function, D(θh), can be observed from the retroreﬂective responses of the measured materials as shown in Figure 6. The materials were divided into two groups based on the height of the peak which can be seen as an indication of surface roughness. The highest peak, from steel, was more than 400. Once the peak ﬂattens out, the remaining portion of the curve is likely due to diﬀuse reﬂectance.
The vast majority of the MERL materials have specular lobes with tails that are much longer than traditional specular models. An example is the chrome sample shown in Figure 9. The specular response of this material is typical for smooth, highly polished surfaces, with a specular peak only a couple of degrees wide and a specular tail that is many times wider. Curiously, the traditional Beckmann, Blinn Phong, and Gaussian distributions are nearly identical at this width and cannot represent either the peak or the tail well.
The need for a wider tail was the motivation for the GGX distribution introduced by Walter et al. (2007) [33]; GGX has a much longer tail than other distributions but still fails to capture the glowy
7

100

1.0

0.01

0

5

10

Figure 9: Several specular distributions ﬁt to MERL chrome. Left: log-scale plots of specular peak vs
θh (degrees); black = chrome, red = GGX (α = 0.006), green = Beckmann (m = 0.013), blue = Blinn Phong (n = 12000). Right: (clipped) point light responses from chrome, GGX, and Beckmann.

highlight of the chrome sample. The importance of modeling the tail response for ﬁtting measured materials was also the basis of two recent models, L¨ow et al. (2012) [17] and Bagher et al. (2012) [4]. Both of these models add an additional parameter to control the tail separately from the peak. Another option for modeling the tail is the use of a second wider specular peak added to the ﬁrst as suggested by Ngan [21].
4.3 Specular F observations

1.0

0.8

0.6

0.4

0.2

0.0 0

30

60

90

θd

Figure 10: Normalized Fresnel responses of MERL 100 materials plotted at vs θd. Responses were averaged over θh from 1 to 4 degrees, the incident response was subtracted oﬀ, and the curves were then normalized over θd from 45 to 80 degrees for comparison of shape. The dashed line represents the theoretical Fresnel response.
The Fresnel reﬂection factor, F (θd), represents the increase in specular reﬂection as the light and view vectors move apart and predicts that all smooth surfaces will approach 100% specular reﬂection at grazing incidence. For rough surfaces, 100% specular reﬂection will not be achieved, but reﬂectance will still become increasingly specular.
Fresnel response curves for the MERL materials are shown in Figure 10. The curves were oﬀset

8

and scaled to compare the overall shape of their response. Every material shows some increase in

reﬂectance near θd = 90. This can also be seen along the top edges of the image slices in Figure 1. Notably, the steepness of many of the curves near grazing angles is greater than predicted by

the Fresnel eﬀect. This observation was in fact the motivation of the Torrance-Sparrow (1967) [30]

microfacet model to explain the “oﬀ-specular peak” witnessed at higher incidence angles. Note that

the

1 4 cos θl cos θv

factor

in

the

microfacet

model

goes

to

inﬁnity

at

grazing angles.

The reason

that this

is not a problem (both in the model and the real world) is that grazing reﬂectance is reduced by

shadowing eﬀects of the microsurface. The G factor represents the shadowing of the light vector and,

symmetrically, the masking of the view vector, and keeps the grazing reﬂectance in check. But even

though

the

G

factor represents

shadowing,

the

combination of

G

with

1 4 cos θl cos θv

eﬀectively ampliﬁes

the Fresnel eﬀect.

4.4 Specular G (and albedo) observations

1.0

1.0

0.8

0.8

0.6

0.6

0.4

0.4

0.2

0.2

0.0 0

30

60

90 0.00

30

60

90

θl

θl

Figure 11: Albedo plots of MERL 100 materials. Left: 50 smooth materials; right: 50 rough materials.

It is diﬃcult to isolate G in the measured data as it requires accurate estimation of the D and F

factors as well as isolation of specular from diﬀuse. However, the eﬀect of G can be seen indirectly in

its eﬀect on the directional albedo.

Albedo is the ratio of total reﬂected energy to total incident energy. In broad terms, it is repre-

sentative of the color of a surface and must be less than 1 for all wavelengths. Albedo can also be

considered for light coming from a single direction, such as from the sun, in which case the albedo

becomes a directional function dependent on incident angle, and must be less than 1 for all angles and

wavelengths.

The directional albedo of most materials is relatively ﬂat for the ﬁrst 70 degrees as seen in Figure 11,

and the albedo at grazing angles is strongly correlated with surface roughness. Smooth materials show

a slight increase around 75 degrees followed by a drop towards 90. Rough surfaces increase, often

signiﬁcantly, all the way to the grazing incidence. Notably, the albedo values overall are fairly low,

with few materials having an albedo above 0.3.

The grazing retro-reﬂection exhibited by many rough materials also contributes signiﬁcantly to this

gain, as evidenced by a chromatic tint in the albedo.

The albedo response corresponding to a selection of modeled G factors is shown in Figure 12 for

both

a

very

smooth

and

a

very

rough

surface.

Notably,

omitting

G

and

1 cos θl cos θv

entirely,

referred

to

as the “No G” model, results in an overly dark response at grazing angles. The important point here

9

0.6 Walter 2007 Ashikhmin-Shirley 2001 Kurt 2010 Ward 1992 No G

0.1

0

90 0

90

Figure 12: Albedo plots comparing several specular G models. All plots use the same D (GGX/TR)

and F factors. Left: smooth surface (α = 0.02); right: rough surface (α = 0.5). The “no G” model

excludes the

G and

1 cos θl cos θv

factors.

is that the choice of the G function has a profound eﬀect on the albedo which in turn has a profound eﬀect on surface appearance.
Several specular models have been developed speciﬁcally with the goal of producing a more plausible albedo response curve [30, 29, 19, 20, 8, 9, 33, 10, 14]. For some of these, the intent is to make the albedo perfectly ﬂat to maintain energy balance. Based on the albedo plots of the Merl data in Figure 11, this is not an unreasonable target though most of the materials do show some sort of grazing gain. Even then, some of the grazing gain is likely due to non-specular eﬀects.
With a few simplifying assumptions, it’s possible to derive the shadowing function from the microfacet distribution, D, following the method of Smith [29]. This was the approach used by Walter (2007) and Schlick (1994). As can be seen in Figure 12, the grazing reﬂectance of the Smith model from Walter increases signiﬁcantly for smooth surfaces, an eﬀect that is not seen in the measured data. For rougher values, the response seems more plausible. Note that the Smith G has an analytic form for only a small number of functions and a tabular integration or some other approximation is often used.
A recent empirical model from Kurt et al. (2010) [14] takes a diﬀerent approach and proposes a data-ﬁtting model with a free parameter. Figure 12 shows the Kurt model using α = 0.25; other values of α can produce a wide range of albedo responses. Of concern though is that the Kurt albedo diverges near grazing angles, signiﬁcantly for rough distributions. Another option is to just use one of the Smith G derivations from Walter, or even the simpler one from Schlick, and decoupling the G roughness as a free parameter.

4.5 Fabric
Many of the fabric samples in the MERL database exhibit a specular tint at grazing angles and also have a Fresnel peak that is stronger than with materials of comparable roughness. Examples of these are shown in Figure 13.
The tinted grazing response could be explained by the fact that cloth often has transmissive ﬁbers which pick up the material color near object silhouettes. This could also explain additional gain for

10

black-fabric

blue-fabric

green-fabric

pink-fabric2

red-fabric2

white-fabric

Figure 13: BRDF image slices of various fabric samples.

cloth at grazing angles beyond what is predicted by the microfacet model. While many fabrics can have very complex material response, the MERL fabrics seem relatively
easy to model.
4.6 Iridescence

Figure 14: BRDF image slices of color-changing-paint-1, 2, and 3. Top row: original data; bottom row: corresponding chroma images generated by scaling by 1/ max(r, g, b) per pixel.
Three color changing paints, shown in Figure 14, exhibit coherent patches of color across the (θh, θd) space with minimal dependence on φd. This appears to be a completely specular phenomenon given that there’s very little reﬂectance away from the specular peak. This could be modeled simply by modulating the specular hue as a function of θh and θd perhaps with a small texture map.
4.7 Data anomalies
Some anomalies in the MERL data are shown in Figure 15. • Some of the very shiny materials, particularly the metals, exhibit asymmetric highlights suggestive of lens ﬂare or perhaps anisotropic surface scratches.
• Data past about 75 degrees appears to be extrapolated.
• The grazing response of the fabrics often has strange discontinuities, possibly due to the fabrics being stretched over spheres during capture and wrinkled near the edges.
• Some of the woods exhibit specular modulation patterns along θd that might be due to wood grain.
11

Figure 15: Anomalies in the MERL data. From left to right: the point-light response of steel exhibits an asymmetric highlight, a chroma plot of color-changing-paint1 shows extrapolated grazing data (visible in all materials), white-fabric exhibits shadowing near grazing suggestive of a wrinkle, and fruitwood-241 (shown as stored, in warped-θh space) exhibits specular variation suggestive of wood grain.
• Subsurface scattering eﬀects are baked in. These are not criticisms of the data or the capture process but rather just a caution to not overﬁt or overinterpret the data. It’s also potentially part of the answer to the question posed earlier about why some materials are hard to ﬁt.
5 Disney “principled” BRDF
5.1 Principles
In developing our new physically based reﬂectance model, we were cautioned by artists that we need our shading model to be art directable and not necessarily physically correct. Because of this, our philosophy has been to develop a “principled” model rather than a strictly physical one.
These were the principles that we decided to follow when implementing our model: 1. Intuitive rather than physical parameters should be used. 2. There should be as few parameters as possible. 3. Parameters should be zero to one over their plausible range. 4. Parameters should be allowed to be pushed beyond their plausible range where it makes sense. 5. All combinations of parameters should be as robust and plausible as possible. We thoroughly debated the addition of each parameter. In the end we ended up with one color parameter and ten scalar parameters described in the following section.
5.2 Parameters
• baseColor: the surface color, usually supplied by texture maps. • subsurface: controls diﬀuse shape using a subsurface approximation. • metallic: the metallic-ness (0 = dielectric, 1 = metallic). This is a linear blend between two
diﬀerent models. The metallic model has no diﬀuse component and also has a tinted incident specular, equal to the base color. • specular: incident specular amount. This is in lieu of an explicit index-of-refraction.
12

• specularTint: a concession for artistic control that tints incident specular towards the base color. Grazing specular is still achromatic.
• roughness: surface roughness, controls both diﬀuse and specular response. • anisotropic: degree of anisotropy. This controls the aspect ratio of the specular highlight. (0 =
isotropic, 1 = maximally anisotropic.) • sheen: an additional grazing component, primarily intended for cloth. • sheenTint: amount to tint sheen towards base color. • clearcoat: a second, special-purpose specular lobe. • clearcoatGloss: controls clearcoat glossiness (0 = a “satin” appearance, 1 = a “gloss” appearance).
Rendered examples of the eﬀect of each of our parameters are shown in Figure 16.

subsurface

0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0

metallic specular specularTint roughness anisotropic

sheen sheenTint clearcoat clearcoatGloss

Figure 16: Examples of the eﬀect of our BRDF parameters. Each parameter is varied across the row from zero to one with the other parameters held constant.

13

5.3 Diﬀuse model details

Some models include a diﬀuse Fresnel factor such as:

(1 − F (θl))(1 − F (θd))

where F (θ) is the Fresnel factor for reﬂection. [Note: from the Fresnel law for refraction, and to preserve Helmholtz reciprocity, it’s necessary to
account for refraction twice, once on the way in and once on the way out of the surface.] As seen in the measured data observations, and based on our past studio experience, the Lambert
diﬀuse model is often too dark on the edges, and adding a Fresnel factor to make it more physically plausible only makes it darker.
Based on our observations, we developed a novel empirical model for diﬀuse retroreﬂection that transitions between a diﬀuse Fresnel shadow for smooth surfaces and an added highlight for rough surfaces. A possible explanation for this eﬀect may be that, for rough surfaces, light enters and exits the sides of micro-surface features, causing an increase in refraction at grazing angles. In any event, our artists like it, and it is similar to features we used to have in our ad-hoc model except that it is now more plausible and has a physical basis.
In our model, we ignore the index of refraction for the diﬀuse Fresnel factor and assume no incident diﬀuse loss. This allows us to directly specify the incident diﬀuse color. We use the Schlick Fresnel approximation and modify the grazing retroreﬂection response to go to a speciﬁc value determined from roughness rather than zero.
Our base diﬀuse model is:

baseColor

fd =

π

1 + (FD90 − 1)(1 − cos θl)5

1 + (FD90 − 1)(1 − cos θv)5

where

FD90 = 0.5 + 2roughness cos2 θd

This produces a diﬀuse Fresnel shadow that reduces the incident diﬀuse reﬂectance by 0.5 at grazing angles for smooth surfaces and increases the response by up to 2.5 for rough surfaces. This seems to provide a reasonable match to the MERL data and was also found to be artistically pleasing. BRDF image slices of our model for various roughness values are shown in Figure 17.

0.0

0.2

0.4

0.6

0.8

1.0

Figure 17: BRDF images slices of our model for various roughness values.
Our subsurface parameter blends between the base diﬀuse shape and one inspired by the HanrahanKrueger subsurface BRDF [11]. This is useful for giving a subsurface appearance on distant objects and on objects where the average scattering path length is small; it’s not, however, a substitute for doing full subsurface transport as it won’t bleed light into the shadows or through the surface.
5.4 Specular D details
Of the popular models, GGX has the longest tail. This model is in fact equivalent to the TrowbridgeReitz (1975) [31] distribution favored by Blinn (1977) [6] for its ability to match experimental data. However, this distribution still does not have a long enough tail for many materials.

14

Trowbridge and Reitz compared their distribution function along with several other distributions to measurements of ground glass. One of the other distributions, from Berry (1923), has a very similar form but with an exponent of 1 instead of 2 resulting in an even longer tail. This suggests a more general distribution with a variable exponent, introduced here and dubbed Generalized-Trowbridge-Reitz, or GTR:
DBerry = c/(α2 cos2 θh + sin2 θh) DTR = c/(α2 cos2 θh + sin2 θh)2
DGTR = c/(α2 cos2 θh + sin2 θh)γ
In each of these distributions, c is a scaling constant, and α is a roughness parameter with values between 0 and 1; α = 0 produces a perfectly smooth distribution (i.e. a delta function at θh = 0) and α = 1 produces a perfectly rough or uniform distribution.
GTR γ = 1 GTR γ = 2 (TR/GGX) GTR γ = 10 Beckmann

0

5

10

15

20

25

30

θd

Figure 18: GTR distribution curves vs θh for various γ values:

Preliminary ﬁtting results suggest typical values of γ between 1 and 2. Interestingly, GTR with

γ

=

3 2

is

equivalent

to

the

Henyey-Greenstein

phase

function

for

θ

=

2θh;

doubling

of

θh

can

be

viewed

as extending the distribution from the hemisphere to the sphere.

A plausible microfacet distribution must be normalized, and for eﬃcient rendering it must also

support importance sampling. Both require the distribution to be integrable over the hemisphere.

Fortunately, this function has a simple closed-form integral. Normalization and importance sampling

functions as well as an eﬃcient anisotropic form are derived in Appendix B.

For our BRDF, we chose to have two ﬁxed specular lobes, both using the GTR model. The primary

lobe uses γ = 2, and the secondary lobe uses γ = 1. The primary lobe represents the base material

and may be anisotropic and/or metallic. The secondary lobe represents a clearcoat layer over the base

material, and is thus always isotropic and non-metallic.

For roughness, we found that mapping α = roughness2 results in a more perceptually linear

change in the roughness. Without this remapping, very small and non-intuitive values were required

for matching shiny materials. Also, interpolating between a rough and smooth material would always

produce a rough result. The resulting interpolation is shown in Figures 16 and 19.

In place of an explicit index of refraction, or IOR, our specular parameter determines the incident

specular amount. The normalized range of this parameter is remapped linearly to the incident specular

range [0.0, 0.08]. This corresponds to IOR values in the range [1.0, 1.8], encompassing most common

materials. Notably, the middle of the parameter range corresponds to an IOR of 1.5, a very typical

value, and is also our default. The specular parameter may be pushed beyond one to reach higher IOR

values but should be done with caution. This mapping of the parameter has helped greatly in getting

15

artists to make plausible materials given that real-world incident reﬂectance values are so unintuitively low.
For our clearcoat layer, we use a ﬁxed IOR of 1.5, representative of polyurethane, and instead allow artists to scale the overall strength of the layer using the clearcoat parameter. The normalized parameter range corresponds to an overall scale of [0, 0.25]. This layer, even though it has a large visual impact, represents a relatively small amount of energy so we don’t subtract any energy from the base layer. When set to zero, the clearcoat layer is eﬀectively disabled and incurs no cost.
5.5 Specular F details
For our purposes, the Schlick Fresnel approximation [28] is suﬃcient and substantially simpler than the full Fresnel equations; the error introduced by the approximation is signiﬁcantly less than the error due to the other factors.
FSchlick = F0 + (1 − F0)(1 − cos θd)5
The constant, F0, represents the specular reﬂectance at normal incidence and is achromatic for dielectrics and chromatic (i.e., tinted) for metals. The actual value depends on the index of refraction. Note that specular reﬂection comes from microfacets and thus F depends on θd, the angle between the light vector and the micronormal (i.e., the half vector), not the angle of incidence with the surface normal.
The Fresnel function can be seen as interpolating (non-linearly) between the incident specular reﬂectance and unity at grazing angles. Note that the response becomes achromatic at grazing incidence as all light is reﬂected.
5.6 Specular G details
For our model, we took a hybrid approach. Given that the Smith shadowing factor is available for the primary specular, we use the G derived for GGX by Walter but remap the roughness to reduce the extreme gain for shiny surfaces. Speciﬁcally, we linearly scale the original roughness from the [0, 1] range to a reduced range, [0.5, 1], for the purposes of computing G. Note: we do this before squaring the roughness as described earlier, so the ﬁnal αg value is (0.5 + roughness/2)2.
This remapping was based on comparisons with measured data as well as artist feedback that the specular was just “too hot” for small roughness values. This gives us a G function that varies with roughness, is at least partially physically based, and seems plausible. For our clearcoat specular we don’t have a Smith G derivation and simply use the GGX G with a ﬁxed roughness of 0.25, found to be plausible and artistically pleasing.
5.7 Layering vs parameter blending
Once we settled on our new model we needed to decide how to integrate it into our shaders. The ﬁrst question was which parameters needed to be spatially varying, and the answer was all of them; if an artist simply wants to put two diﬀerent materials on a surface and mask between them, then they will need to interpolate between all of the parameters. Also, the mask will be ﬁltered and at the blurred edge of the mask the material response must remain plausible.
One beneﬁt of our design principles in making all the parameters normalized and at least perceptually linear is that materials generally interpolate in a very intuitive way. An example of this is shown in Figure 19.
Once we realized we could interpolate robustly, we wondered whether we could achieve all spatial variation through masks. The idea is that the artist would choose a list of material presets and
16

Figure 19: Interpolating between two very diﬀerent materials, shiny metallic gold and blue rubber, using our model.
Figure 20: A screenshot of our shader editor showing material layers. The variables in the mask expressions refer to spatially varying shader modules, typically texture maps.
then simply blend between them using texture masks. This turned out to be phenomenally successful, greatly simplifying workﬂow, improving material consistency, and making our shader evaluation extremely eﬃcient. Our shader UI is shown in Figure 20.
6 Production experience on Wreck-It Ralph
We deployed our “Principled Layers” shader on Wreck-It Ralph and used it on virtually every material except for hair (which still uses the model developed for Tangled). A variety of materials can be seen in Figure 21. Note that a separate normal was often used for the specular components to produce the sparkle eﬀect seen here on the ground, carpet, and other granulated materials.
In conjunction with our new material model, we also introduced new sampled area and image-based lights which are critical for making plausible materials look good; if you make a plausible shiny material and light it with a point light your highlight will be a tiny dot, but allowing lighters to adjust material properties, such as increasing roughness to fake an area light response, destroys the entire physically based shading paradigm. The good news is that the lighters really like area lights and IBLs for their controllability and also appreciate having a consistent material response. It’s also worth noting that the new material model was both a motivator and an enabler in the switch to sampled lights in that with our previous ad-hoc shading model it would have been too expensive for each reﬂectance module to perform its own sampled light integration.
Based on the success on Wreck-It Ralph, our next shows are already using or planning to use our new shading model without modiﬁcation.
17

Figure 21: Production still from Wreck-It Ralph.
6.1 Look development
One beneﬁt of having a single BRDF on everything is that it simpliﬁed the development of our interactive material editor. Our “Material Designer” renders out a geometry buﬀer (or “g-buﬀer”) containing normals, object IDs, and material layer masks. Using these channels, it quickly performs image-based relighting while allowing all BRDF parameters to be interactively edited. Artists can rotate IBLs in real-time and see the full eﬀect of all parameters and layers in full context on production models.
Another beneﬁt of the uniﬁed model is that it facilities a very simple material library consisting of a set of presets saved out from the Material Designer. A material can be picked from the library and added to a shader as an additional layer and then blended in with a mask. Layers can thus be quickly built up like a Photoshop layer stack.
To judge a material fully, it’s critical to light it from all angles. As part of the switch to our new material model, we started prooﬁng all elements using a variety of IBLs and all turntables include both element and lighting rotations.
The end result of our new shader system is greatly improved productivity in look development, much shorter training time for new artists, and more consistently high-quality results. Notably, most of our look development artists were able to roll oﬀ of the show early due to the lack of the need for material “re-do”s in lighting. This was unprecedented.
6.2 Lighting
As mentioned earlier, a diﬀerent approach to lighting was needed to work with the new material model. This required a large learning curve. It was also a challenge adding back in artistic controls to lighting without overly compromising the physically based model.
One of the biggest changes in lighting was the move to using IBLs as local ﬁll lights. Most IBLs are used with light linking to speciﬁc elements in the shot and many have distance cutoﬀs. These were a big improvement over previous environment maps which largely ignored the material characteristics. Area lights were also a well-received addition.
One of the biggest challenges for lighters initially was working with realistic light intensity values and falloﬀ. We eventually developed a non-physical falloﬀ control that works by making the light source virtually more distant while automatically adjusting the intensity to achieve the desired exposure at a
18

given distance, however controlling light intensity and falloﬀ remains a challenge for lighters. Another challenge for lighting is the fact that specular highlights now require some sort of tone
mapping. Highlights on shiny materials can reach into the hundreds and simply clipping the values appears harsh, introduces banding as each color channel clips at a diﬀerent location, and forces the core to always go to white. We developed a new global tone mapping operator that preserves color values for most of the display range and rolls oﬀ the top end while preserving color and contrast. We have a default setting that works reasonably in most cases but adjust the ﬁnal values per shot during color grading.
In the end though, the materials behave predictably which is a huge beneﬁt to lighters and gives them a starting point that is physically plausible.
6.3 Future work
One of the biggest issues currently is the lack of an intuitively controllable subsurface model. A key aspect of this is BRDF integration. Ideally there would be a match between the BRDF and the subsurface model such that the BRDF model could be used for distant objects, achieving equivalent results. Also, an artist should be able to increase the mean-free path from zero to add a subsurface eﬀect to an object without changing the overall exposure — just the shape of the diﬀuse should change (and light should bleed into the shadows if diﬀusion is enabled).
We would like to go further with modeling cloth reﬂectance. We know we can add a special shader to render cloth using captured reﬂectance data for particularly complicated cloth models, but we would like to investigate direct modeling of a wider range of cloth materials. We don’t currently have a show that is driving this need though.
We’ve also received requests to add iridescence to our model. This should be as simple as adding specular color variation as previously discussed.
Acknowledgments
First and foremost, I would like to thank Chuck Tappan who co-developed our new material parameterization and championed our new look development pipeline. I would also like to thank Christian Eisenacher for his work on the Material Designer, and Greg Nichols and Jared Johnson for their work on the Disney BRDF Viewer. And I would like to thank the Ralph Look and Lighting crew for their patience and support. Finally I would like to thank Stephen Hill, Naty Hoﬀman, and Pete Shirley for their valuable input, and Stephen in particular for suggesting the projected half vector formulation in equation (14) in Appendix B.
References
[1] Michael Ashikhmin. Distribution-based brdfs. Technical report, 2007.
[2] Michael Ashikhmin, Simon Prem˘oze, and Peter Shirley. A Microfacet-Based BRDF generator. In Sheila Hoﬀmeyer, editor, Proceedings of the Computer Graphics Conference 2000 (SIGGRAPH00), pages 65–74, New York, July 23–28 2000. ACMPress.
[3] Michael Ashikhmin and Peter Shirley. An anisotropic Phong BRDF model. Journal of Graphics Tools: JGT, 5(2):25–32, 2000.
[4] M. M. Bagher, C. Soler, and N. Holzschuch. Accurate ﬁtting of measured reﬂectances using a shifted gamma micro-facet distribution. Computer Graphics Forum, 31(4):1509–1518, 2012.
19

[5] P. Beckmann and A. Spizzichino. The scattering of electromagnetic waves from rough surfaces. MacMillan, 1963.
[6] James F. Blinn. Models of light reﬂection for computer synthesized pictures. volume 11, pages 192–198, July 1977.
[7] R. L. Cook and K. E. Torrance. A reﬂectance model for computer graphics. Computer Graphics, 15(3):307–316, 1981.
[8] Arne Du¨r. An improved normalization for the Ward reﬂectance model. Journal of graphics, gpu, and game tools, 11(1):51–59, 2006.
[9] Dave Edwards, Solomon Boulos, Jared Johnson, Peter Shirley, Michael Ashikhmin, Michael Stark, and Chris Wyman. The halfway vector disk for brdf modeling. ACM Trans. Graph., 25(1):1–18, January 2006.
[10] David Geisler-Moroder and Arne Du¨r. A new Ward BRDF model with bounded albedo. Comput. Graph. Forum, 29(4):1391–1398, 2010.
[11] Pat Hanrahan and Wolfgang Krueger. Reﬂection from layered surfaces due to subsurface scattering. In Proceedings of the 20th annual conference on Computer graphics and interactive techniques, SIGGRAPH ’93, pages 165–174, New York, NY, USA, 1993. ACM.
[12] Xiao D. He, Kenneth E. Torrance, Francois X. Sillion, and Donald P. Greenberg. A Comprehensive Physical Model for Light Reﬂection. In Computer Graphics (ACM SIGGRAPH ’91 Proceedings), volume 25, pages 175–186, July 1991.
[13] Csaba Kelemen, Laszlo Szirmay-Kalos, and L´aszl´o Szirmay-kalos. A microfacet based coupled specular-matte brdf model with importance sampling. Eurographics Short Presentations, 2001.
[14] Murat Kurt, L´aszl´o Szirmay-Kalos, and Jaroslav Kˇriv´anek. An anisotropic brdf model for ﬁtting and monte carlo rendering. SIGGRAPH Comput. Graph., 44(1):3:1–3:15, February 2010.
[15] Eric P. Lafortune, Sing-Choong Foo, Kenneth E. Torrance, and Donald P. Greenberg. Nonlinear approximation of reﬂectance functions. In Computer Graphics (ACM SIGGRAPH ’97 Proceedings), volume 31, pages 117–126, 1997.
[16] Robert R. Lewis. Making Shaders More Physically Plausible. In Fourth Eurographics Workshop on Rendering, number Series EG 93 RW, pages 47–62, Paris, France, June 1993.
[17] Joakim L¨ow, Joel Kronander, Anders Ynnerman, and Jonas Unger. Brdf models for accurate and eﬃcient rendering of glossy surfaces. ACM Trans. Graph., 31(1):9:1–9:14, February 2012.
[18] Wojciech Matusik, Hanspeter Pﬁster, Matt Brand, and Leonard McMillan. A data-driven reﬂectance model. ACM Transactions on Graphics, 22(3):759–769, July 2003.
[19] L´aszl´o Neumann, Attila Neumann, and L´aszl´o Szirmay-Kalos. Compact metallic reﬂectance models. Computer Graphics Forum, 18(3):161–172, September 1999. ISSN 1067-7055.
[20] L´aszl´o Neumann, Attila Neumann, and L´aszl´o Szirmay-Kalos. Reﬂectance models by pumping up the albedo function. In Machine Graphics and Vision, pages 3–18, 1999.
[21] Addy Ngan, Fr´edo Durand, and Wojciech Matusik. Experimental analysis of BRDF models. In Kavita Bala and Philip Dutr´e, editors, Eurographics Symposium on Rendering, pages 117–126, Konstanz, Germany, 2005. Eurographics Association.
20

[22] Ko Nishino and Stephen Lombardi. Directional statistics-based reﬂectance model for isotropic bidirectional reﬂectance distribution functions. J. Opt. Soc. Am. A, 28(1):8–18, Jan 2011.
[23] Michael Oren and Shree K. Nayar. Generalization of lambert’s reﬂectance model. In SIGGRAPH, pages 239–246. ACM, 1994.
[24] Romain Pacanowski, Oliver Salazar Celis, Christophe Schlick, Xavier Granier, Pierre Poulin, and Annie Cuyt. Rational brdf. IEEE Transactions on Visualization and Computer Graphics, 99(PrePrints), 2012.
[25] Bui-T. Phong. Illumination for computer generated pictures. Communications of the ACM, 18(6):311–317, June 1975.
[26] Fabiano Romeiro, Yuriy Vasilyev, and Todd Zickler. Passive reﬂectometry. In Proceedings of the 10th European Conference on Computer Vision: Part IV, ECCV ’08, pages 859–872, Berlin, Heidelberg, 2008. Springer-Verlag.
[27] Iman Sadeghi, Heather Pritchett, Henrik Wann Jensen, and Rasmus Tamstorf. An artist friendly hair shading system. In ACM SIGGRAPH 2010 papers, SIGGRAPH ’10, pages 56:1–56:10, New York, NY, USA, 2010. ACM.
[28] Christophe Schlick. An Inexpensive BRDF Model for Physically-Based Rendering. Computer Graphics Forum, 13(3):233–246, 1994.
[29] B. Smith. Geometrical shadowing of a random rough surface. IEEE Trans. Ant. and Propagation, AP-15(5):668–671, September 1967.
[30] K. Torrance and E. Sparrow. Theory for oﬀ-specular reﬂection from roughened surfaces. J. Optical Soc. America, 57:1105–1114, 1967.
[31] S. Trowbridge and K. P. Reitz. Average irregularity representation of a rough ray reﬂection. Journal of the Optical Society of America, 65(5):531–536, May 1975.
[32] Bruce Walter. Notes on the Ward BRDF. Technical Report PCG-05-06, Cornell Program of Computer Graphics, 2005.
[33] Bruce Walter, Stephen R. Marschner, Hongsong Li, and Kenneth E. Torrance. Microfacet models for refraction through rough surfaces. In Proceedings of the Eurographics Symposium on Rendering, 2007.
[34] Gregory J. Ward. Measuring and modeling anisotropic reﬂection. In Edwin E. Catmull, editor, Computer Graphics (SIGGRAPH ’92 Proceedings), volume 26, pages 265–272, July 1992.
[35] L. B. Wolﬀ, S. K. Nayar, and M. Oren. Improved diﬀuse reﬂection models for computer vision. International Journal of Computer Vision, 30(1):55–71, October 1998.
A Selected history of BRDF models used in graphics
• Beckmann 1963 [5] provided a model for scattering from rough surfaces based on a Gaussian distribution of surface slopes.
• Torrance and Sparrow 1967 [30] introduced the microfacet model. A Gaussian distribution of microfacet angles was assumed and a microfacet shadowing factor was derived from simplifying geometric assumptions.
21

• Smith 1967 [29] derived a shadowing function from the microfacet distribution. Notably, this shadowing function varied with surface roughness.
• Phong 1975 [25] proposed a computationally simple model of a specular highlight using an exponentiated cosine.
• Trowbridge and Reitz 1975 [31] derived a new microfacet distribution based on average surface irregularity of curved microsurfaces derived from an ellipsoid of revolution. They ﬁt their model to measured data for rough glass and compared their results with Gaussian, Beckmann, Sirohi, and Berry distributions.
• Blinn 1977 [6] implemented the Torrance-Sparrow model with the Trowbridge-Reitz distribution (chosen for its computational eﬃciency as well as its physical basis). Blinn also proposed a microfacet distribution based based on the Phong model, commonly referred to as “Blinn Phong,” by adapting it to the more physically correct half-vector formulation.
• Cook and Torrance 1981 [7] implemented the Torrance-Sparrow model with the Beckmann distribution and studied spectral shifts due to the Fresnel factor.
• He, Torrance, Sillion, and Greenberg 1991 [12] presented a model that included specular, directional diﬀuse, and uniform diﬀuse components. The model is derived for polarized light and simpliﬁed for unpolarized light.
• Ward 1992 [34] presented an anisotropic specular model derived from the Beckmann distribution. Walter 2005 [32] provided a more eﬃcient exact implementation.
• Lewis 1993 [16] proposed a “modiﬁed Phong” model that included a normalization term for energy conservation.
• Hanrahan and Krueger 1993 [11] developed a diﬀuse BRDF model that approximates subsurface transport.
• Oren and Nayar 1994 [23] derived a diﬀuse model for rough surfaces based on Lambertian microfacets.
• Schlick 1994 [28] developed rational approximations to the various components of the microfacet model. The Schlick Fresnel approximation is widely used. Also, Schlick recognized the discontinuity in the Torrance-Sparrow shadowing term and suggested an approximation of the Smith shadowing function as an alternative. Schlick also presented an approximation to the Beckmann distribution.
• Lafortune 1997 [15] proposed using a sum of arbitrarily oriented Phong lobes as the basis for a general model.
• Wolﬀ, Nayar and Oren 1998 [35] developed an improved diﬀuse model for very smooth surfaces which are darker at grazing angles than Lambert diﬀuse due to the Fresnel eﬀect. This model is also combined in an approximate form with the Oren Nayar model to represent a continuum of smooth to rough diﬀuse surfaces.
• Neumann et al. 1999 [19] proposed a “stretched Phong” model intended for metallic surfaces that has an albedo that becomes ﬂat as the surface becomes shiny.
22

• Neumann et al. 1999b [20] proposed a process to “pump up” the albedo of arbitrary BRDFs to improve energy balance. Previous models were shown to have an albedo that falls oﬀ too quickly with incident angle (except for the Ward model which is shown to diverge at grazing incidence). Each iterative pump up divides the BRDF by a measured correction factor making the albedo progressively ﬂatter.
• Ashikhmin, Premoˇze, and Shirley 2000 [2] derived a shadowing function from numeric integration of arbitrary microfacet distributions.
• Ashikhmin and Shirley 2000 [3] presented a anisotropic Phong model that included a Fresnelweighted diﬀuse and energy conservation guarantees.
• Kelemen and Szirmay-Kalos 2001 [13] proposed an alternative shadowing term that approximates the Torrance-Sparrow shadowing function with a diﬀerentiable form. A coupled-diﬀuse model is also proposed such that the total albedo is always 1.
• Du¨r 2006 [8] improved the energy balance of the Ward model.
• Edwards et al. 2006 [9] proposed the “halfway vector disk” as a new domain for modeling specular distributions with the goal of perfect energy conservation (albedo = 1). An alternate non-conservative form is also presented for data ﬁtting.
• Ashikhmin and Premoˇze 2007 [1] presented the “distribution BRDF” which smooths out the discontinuity in the shadowing term of Ashikhmin Shirley. A simple method for estimating specular distributions from backscattering images (such as from a single ﬂash-lit photograph) is also provided.
• Walter et al. 2007 [33] derived Smith shadowing functions for the Phong and GGX distributions and provided an approximation of Smith shadowing for the Beckmann distribution. Note: GGX is equivalent to the Trowbridge-Reitz distribution.
• Romeiro et al. 2008 [26] showed than the MERL materials are well-represented by a simple bivariate form, ρ(θh, θd) and exploited this fact to proposed a simpliﬁed BRDF capture method.
• Geisler-Moroder and Du¨r 2010 [10] further reﬁned this model to restore Helmholtz reciprocity and guarantee energy conservation.
• Kurt et al 2010 [14] extended the Beckmann distribution to anisotropic form and proposed a new parameterized shadowing function giving control over albedo and improving ﬁtting for some materials. Two specular lobes are suggested for ﬁtting many of the MERL materials.
• Nishino and Lombardi 2011 [22] proposed the “hemispherical exponential power distribution” or “Hemi-EPD” which has an additional degree of freedom to improve ﬁtting power. The HemiEPD is used as a basis for the entire BRDF and parameters are ﬁt to individual θd slices and interpolated. Additionally, multiple lobes per θd slice are required for many materials.
• L¨ow et al. 2012 [17] proposed a new “ABC” microfacet distribution inspired by Rayleigh-Rice smooth-surface scattering theory. Additionally, the “projected deviation vector” is presented as an alternative to the half-vector parameterization for data ﬁtting.
• Pacanowski et al. 2012 [24] developed a framework for ﬁtting rational functions to general isotropic BRDFs over the (θh, θd) domain. An anisotropic form is also proposed as a simple scaling of the isotropic form with respect to φh.
23

• Bagher et al. 2012 [4] proposed a new “shifted gamma” or “SGD” microfacet distribution derived to ﬁt the range of observed slopes in the MERL database. An approximation of the Smith shadowing function for the SGD is provided. Additionally, the Fresnel term is modiﬁed with a correction term providing an additional degree of freedom, improving ﬁtting ability.

B GTR Microfacet Distribution

B.1 Microfacet distribution review

A plausible microfacet distribution must be normalized over the hemisphere such that the projected area of the microfacets is 1 [33]:

or in spherical coordinates:

D(θh) cos θh dω = 1
Ω

2π π/2
D(θh) cos θh sin θh dθh dφh = 1
00

For importance sampling, it is convenient to choose pdfh = D(θh) cos θh given that it is already

normalized. Note, pdfh is the density with respect to the half vector; the density with respect to the

light vector l is:

pdfl

=

pdfh 4(l · h)

To generate samples over the hemisphere, the pdf is split into spherical components, pdfh =

pdfθhpdfφh. For isotropic distributions this factorization is trivial as the distribution has no dependence

on

φh

and

pdfφh

=

1 2π

.

For

anisotropic

distributions,

the

factorization

is

accomplished

by

integrating

out θh to get:

π 2
pdfφh = pdfh sin θh dθh
0

pdfθh

=

pdfh pdfφh

Each component pdf is then integrated to form a cdf and then inverted to form a corresponding sampling function:

x
cdf(x) = pdfx dx
0
x = cdf−1(ξ)
Given the two sampling functions and uniform random variables ξ1 and ξ2, θh and φh can be computed and projected to the coordinate frame around the normal n, tangent x, and bitangent y to form the half vector h. Finally, given a v vector, l can be computed by reﬂecting h across v:
h = sin θh cos φhx + sin θh sin φhy + cos θhn l = 2(v · h)h − v

24

B.2 GTR

Following the above derivations, the normalized GTR distribution and sampling equations are:

(γ − 1)(α2 − 1)

1

DGTR(θh) = π(1 − (α2)1−γ) (1 + (α2 − 1) cos2 θh)γ

(1)

φh = 2πξ1

(2)

cos θh =

1

−

[(α2

)1−γ

(1

−

ξ2

)

+

ξ2

]

1 1−γ

1 − α2

(3)

This distribution is valid for any γ > 0, however, at γ = 1 there is a singularity. Taking the limit as γ → 1 produces this alternate form:

α2 − 1

1

DGTR1(θh) = π log α2 (1 + (α2 − 1) cos2 θh)

(4)

1 − (α2)1−ξ2

cos θh =

1 − α2

(5)

The values of γ = 3/2 and γ = 2 have simpliﬁed forms, the latter being equivalent to GGX:

α2 + α

1

DGTR3/2 (θh) = 2π (1 + (α2 − 1) cos2 θh)3/2

(6)

1

α2

cos θh = 1 − α2 1 − (1 + (α − 1)ξ2)2

(7)

α2

1

DGTR2 (θh) = π (1 + (α2 − 1) cos2 θh)2

(8)

cos θh =

1 − ξ2 1 + (α2 − 1)ξ2

(9)

To

form

an

anisotropic

distribution,

the

roughness

is

varied

with

φ

by

replacing

1 α2

with

cos2 α2x

φ

+

sin2 α2y

φ

.

For γ = 2 this results in:

11

1

DGTR2aniso = π αxαy sin2 θh cos2 φh/αx2 + sin2 φh/αy2 + cos2 θh 2

(10)

tan

φh

=

αy αx

tan

(2πξ1)

(11)

cos θh =

1 − ξ2 1 + 1/ cos2 φh/αx2 + sin2 φh/αy2 − 1 ξ2

(12)

Substituting these vector identities

h · x = sin θh cos φh h · y = sin θh sin φh h · n = cos θh

into equation (10) produces an eﬃcient alternate form:

11

1

DGTR2aniso = π αxαy (h · x)2/αx2 + (h · y)2/αy2 + (h · n)2 2

(13)

25

Further, factoring tan φh from equation (11) into sin φh and cos φh, avoids special handling for the quadrants of φh and also allows h to be calculated more directly:

sin φh

=

αy

sin (2πξ1) r

cos φh

=

αx

cos (2πξ1) r

tan θh = r

ξ2 1 − ξ2

h=

1

ξ2 − ξ2

[αx

cos

(2πξ1)

x

+

αy

sin

(2πξ1)

y]

+

n

(14)

h

h=

(15)

|h |

Note: h is the projected half vector, tan θh cos φhx + tan θh sin φhy + n, and r is a normalization factor (equal to 1/ cos2 φh/αx2 + sin2 φh/αy2 ) which can be ignored due to cancellation.
For arbitrary values of γ, the normalization of the anisotropic distribution unfortunately does not have a closed form.

Addenda
Anisotropic specular details
The original notes omitted the parameterization which is as follows:

aspect = 1 − 0.9 anisotropic αx = roughness2/aspect αy = roughness2 · aspect

The 0.9 factor limits the aspect ratio to 10:1.
Sheen details
The original notes omitted a description of sheen. Based on observations of the fabric samples described in section 4.5, the predominant eﬀect missing from the base diﬀuse + specular model is the extra grazing reﬂectance seen along the top of the BRDF image slices. This component is very similar to the Fresnel factor. As this shape is very Fresnel-like, we model this as an additional BRDF lobe that uses the Schlick Fresnel shape, sheen · (1 − cos θd)5, and is optionally tinted towards the base color according to the sheenT int parameter.
Specular G revisited
Heitz recently published a thorough analysis of the microfacet shadowing function, Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs, JCGT 2014. Heitz proposed the “weak white furnace test” for verifying the plausibility of physically based masking functions and showed
26

that, of known shadowing functions, only the Smith shadowing model [29, 33] and the V-cavity model [7] are plausible, though the latter may be less realistic.
Based on Heitz’ analysis, we have eliminated our ad-hoc remapping of Smith G for our primary specular. For metals, the result is obviously better, and for general materials it is arguably so, especially when rendering in a full GI environment with plausible light sources. It seems very likely that the lack of correlation of the Walter model to the smooth materials was a result of measurement error in the MERL data at grazing angles. Heitz also derived the correct anisotropic form of the Smith shadowing, a detail we had neglected.
For clearcoat, we still use the isotropic GTR 1.0 lobe with the wider tail and the admittedly ad-hoc G factor. This is not meant to represent a physically plausible microfacet surface with corresponding shadowing and masking, but rather it is representing a thin, translucent layer that may encompass multiple reﬂection and transmission events, and our current formulation has worked well for a large variety of materials. That said, a physical model that encompassed all of these eﬀects would be welcome.
Revision history
Version 2 (Aug 31, 2012): corrected normalization factor in Equation 4. Version 3 (Aug 12, 2014): corrected formatting for Equations 10-13; added Addenda.
27

